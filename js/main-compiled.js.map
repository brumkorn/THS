{"version":3,"sources":["main.js"],"names":[],"mappings":"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","file":"main-compiled.js","sourcesContent":["/*\r\n *Excel-like spreadsheet editor.\r\n *\r\n *\r\n *\r\n *\r\n *\r\n *\r\n *@author Shovgenja Oleksij for INSART Trainee\r\n *@version \"0.01 04/05/16\"\r\n */\r\n\r\n// function Cell() {}\r\n\r\n// function FormulaCell() {\r\n//     this.getValue = functino() {}\r\n// }\r\n\r\n// function SheetEditor(param) {\r\n\r\n//     if (1 == 1)\r\n//         this.getValue = function() {\r\n\r\n//         }\r\n\r\n//         let c = new Cell;\r\n\r\n//         FormulaCell.call(c)\r\n\r\n// }\r\n\r\n(function () {\r\n  \"use strict\";\r\n  let a = console.log.bind(console);\r\n\r\n  class Utils {\r\n    static get keyCode() {\r\n      return {\r\n        enter: 13,\r\n        backspace: 8,\r\n        del: 46,\r\n        shift: 16,\r\n        alt: 18,\r\n        ctrl: 17,\r\n        arrows: [37, 38, 39, 40],\r\n        arroRight: 39,\r\n        arrowLeft: 37,\r\n        arrowUp: 38,\r\n        arrowDown: 40,\r\n        equalSign: 187\r\n      };\r\n    }\r\n\r\n    static get regExp() {\r\n      return {\r\n        operators: /[\\+\\-\\*\\/]/,\r\n        cellLink: /([A-Z]+[0-9]+)/gi,\r\n        cellLinkParts: /([A-Z]+)|([0-9]+)/gi,\r\n        cellLinkEnding: /([A-Z]+[0-9]+)$/i,\r\n        pickingInputEnding: /([=\\+\\-\\*\\/])$|([=\\+\\-\\*\\/]+[A-Z]+[0-9]+)$/i,\r\n        validInput: /([A-Z]+[0-9]+)|([0-9]+)|([\\+\\-\\*\\/]+)|([\\(\\)])/gi,\r\n        doublePlusesAndMinuses: /([\\-]{2})|([\\+]{2})/g,\r\n        plusMinus: /(\\+\\-)|(\\-\\+)/g\r\n      }\r\n    }\r\n\r\n    static getNameFromNumber(num) {\r\n      if (typeof num !== \"number\") {\r\n        a(\"Wrong type in getNameFromNumber\" + typeof num);\r\n        debugger;\r\n      }\r\n      let upperLatinLetters = 26,\r\n        upperLatinAUnicode = 65,\r\n        numeric = num % upperLatinLetters;\r\n      let letter = String.fromCodePoint(upperLatinAUnicode + numeric);\r\n      let num2 = Math.floor(num / upperLatinLetters);\r\n      if (num2 > 0) {\r\n        return this.getNameFromNumber(num2 - 1) + letter;\r\n      } else {\r\n        return letter;\r\n      }\r\n    }\r\n\r\n    static getNumberFromName(letter) {\r\n      let numeric = 0,\r\n        upperLatinAUnicode = 65;\r\n\r\n      for (let i = 0; i < letter.length; i++) {\r\n        numeric += letter.charCodeAt(i) - upperLatinAUnicode;\r\n      }\r\n      return numeric;\r\n    }\r\n\r\n    static findCellOnSheet(rowIndex, colIndex, tbody) {\r\n      let targetRow = tbody.children[rowIndex];\r\n      return targetRow.children[colIndex];\r\n    }\r\n\r\n    static getCellName(rowIndex, colIndex) {\r\n      let cellColName = Utils.getNameFromNumber(colIndex);\r\n      let cellRowName = rowIndex + 1;\r\n      return cellColName + cellRowName;\r\n    }\r\n\r\n    static getCellCoordinates(data) {\r\n      if (data instanceof HTMLElement && data.nodeName === \"TD\") {\r\n        let cellNode = data;\r\n        let rowIndex = cellNode.parentElement.rowIndex;\r\n        let colIndex = cellNode.cellIndex;\r\n        let cellName = Utils.getCellName(rowIndex, colIndex);\r\n\r\n        return {\r\n          rowIndex: rowIndex,\r\n          colIndex: colIndex,\r\n          cellName: cellName\r\n        }\r\n      }\r\n\r\n      if (typeof data === \"object\" && data.path) {\r\n        let event = data,\r\n          colIndex,\r\n          rowIndex,\r\n          cellName;\r\n\r\n        if (event.path[0].cellIndex >= 0) {\r\n          colIndex = event.path[0].cellIndex;\r\n          rowIndex = event.path[1].rowIndex;\r\n        } else {\r\n          colIndex = event.path[1].cellIndex;\r\n          rowIndex = event.path[2].rowIndex;\r\n        }\r\n\r\n        cellName = Utils.getCellName(rowIndex, colIndex);\r\n\r\n        return {\r\n          rowIndex: rowIndex,\r\n          colIndex: colIndex,\r\n          cellName: cellName\r\n        };\r\n      }\r\n\r\n      if (typeof data === \"string\") {\r\n        let cellNameArr = data.match(Utils.regExp.cellLinkParts);\r\n        let rowIndex = cellNameArr[1] - 1;\r\n        let colIndex = Utils.getNumberFromName(cellNameArr[0]);\r\n        return {\r\n          rowIndex: rowIndex,\r\n          colIndex: colIndex\r\n        };\r\n      }\r\n    }\r\n\r\n    static parseExpression(inputExp, tbody) {\r\n      let inputArrPattern = Utils.regExp.validInput,\r\n        cellLinkPattern = Utils.regExp.cellLink,\r\n        inputArr = inputExp.match(inputArrPattern) || [],\r\n        links = inputExp.match(cellLinkPattern) || [];\r\n\r\n      let returnArr = inputArr.map(function (current) {\r\n        let matched = current.match(cellLinkPattern);\r\n        if (matched) {\r\n          let cellName = matched[0].toUpperCase();\r\n          let {rowIndex, colIndex} =\r\n            Utils.getCellCoordinates(cellName);\r\n          return Utils.findCellOnSheet(rowIndex, colIndex, tbody);\r\n        }\r\n        return current\r\n      });\r\n\r\n      return {\r\n        parsedInput: returnArr,\r\n        parsedLinks: links\r\n      };\r\n    }\r\n\r\n    static computeValue(inputExp, tbody) {\r\n      let expressionArr = Utils.parseExpression(inputExp, tbody).parsedInput;\r\n      let expressionStr = \"\",\r\n        operators = Utils.regExp.operators,\r\n        doublePlusesAndMinuses = Utils.regExp.doublePlusesAndMinuses,\r\n        plusMinus = Utils.regExp.plusMinus;\r\n\r\n      for (let i = 0; i < expressionArr.length; i++) {\r\n        let item = expressionArr[i];\r\n\r\n        if (typeof item === \"object\" || item.search(operators) === -1) {\r\n          continue;\r\n        }\r\n        while (item.length > 1) {\r\n          if (item.search(doublePlusesAndMinuses) >= 0) {\r\n            item = item.replace(doublePlusesAndMinuses, \"+\");\r\n          }\r\n\r\n          if (item.search(plusMinus) >= 0) {\r\n            item = item.replace(plusMinus, \"-\")\r\n          }\r\n        }\r\n        expressionArr[i] = item;\r\n      }\r\n\r\n      for (let item of expressionArr) {\r\n        if (typeof item === \"object\") {\r\n          expressionStr += item.innerHTML || 0;\r\n        } else {\r\n          expressionStr += item;\r\n        }\r\n      }\r\n\r\n      if (!expressionStr) return \"\";\r\n\r\n      if (expressionStr.charAt(0).search(operators) >= 0) {\r\n        expressionStr = `${0 + expressionStr}`;\r\n      }\r\n      if (expressionStr[expressionStr.length - 1].search(operators) >= 0) {\r\n        expressionStr = `${expressionStr + 0}`;\r\n      }\r\n\r\n      if (expressionStr.search(Utils.regExp.cellLink) >= 0) return \"\";\r\n\r\n      return eval(expressionStr);\r\n    }\r\n  }\r\n\r\n  class SheetEditor {\r\n\r\n    constructor(params) {\r\n      this.target = document.querySelector(\".main\");\r\n      this.columns = Math.abs(26);\r\n      this.rows = Math.abs(50);\r\n\r\n      if (params && typeof params === \"object\") {\r\n        this.target = params.target;\r\n        this.maxColls = params.maxColls;\r\n        this.maxRows = params.maxRows;\r\n        this.readOnly = params.readOnly;\r\n        this.columns = Math.abs(params.columns);\r\n        this.rows = Math.abs(params.rows);\r\n      }\r\n\r\n      this._currentSheet = null;\r\n      this.sheetList = [];\r\n      this.footerToolbar = document.querySelector(\".footer-toolbar\");\r\n      this.serverData = null;\r\n\r\n      this.start();\r\n      this.initListeners();\r\n\r\n\r\n    }\r\n\r\n    get name() {\r\n      return `Editor-for-${this.target.className}-window`;\r\n    }\r\n\r\n    start() {\r\n\r\n\r\n      if (localStorage[`${this.name}`]) {\r\n        this.loadSheets();\r\n        return;\r\n      }\r\n\r\n      this.getServerData(\"http://127.0.0.1:3000/load\", (data) => {\r\n        this.serverData = data;\r\n      });\r\n\r\n      setTimeout(() => {\r\n        if (this.serverData) {\r\n          alert(\"Loading from server\");\r\n          this.loadSheets();\r\n          this.saveData();\r\n          return;\r\n        }\r\n\r\n        localStorage.setItem(this.name, \"\");\r\n        this.addNewSheet();\r\n      }, 0)\r\n\r\n    }\r\n\r\n    loadSheets() {\r\n      let loadedData = this.loadData() || this.serverData;\r\n      loadedData.forEach(function (item) {\r\n        this.initTable();\r\n        this.createSheet(item._currentColumns, item._currentRows, true);\r\n      }, this);\r\n      this.switchSheet(0);\r\n    }\r\n\r\n    loadData() {\r\n      return JSON.parse(localStorage.getItem(this.name));\r\n    }\r\n\r\n    initTable() {\r\n      let windowFrame = this.target;\r\n      let sheetContainer =\r\n          windowFrame.appendChild(document.createElement(\"div\")),\r\n        tableWrapper =\r\n          sheetContainer.appendChild(document.createElement(\"div\"));\r\n      tableWrapper.classList.add(\"table-wrapper\");\r\n\r\n      let colHeaderWrapper =\r\n        sheetContainer\r\n          .insertBefore(document.createElement(\"div\"), tableWrapper);\r\n      colHeaderWrapper.classList.add(\"col-header-wrapper\");\r\n      colHeaderWrapper.appendChild(document.createElement(\"div\"));\r\n      let colHeader =\r\n        colHeaderWrapper.appendChild(document.createElement(\"div\"));\r\n      colHeaderWrapper.appendChild(document.createElement(\"div\"));\r\n      colHeader.classList.add(\"col-header\");\r\n      colHeader.appendChild(document.createElement(\"ol\"));\r\n\r\n      let rowHeader =\r\n        sheetContainer\r\n          .insertBefore(document.createElement(\"div\"), tableWrapper);\r\n      rowHeader.classList.add(\"row-header\");\r\n      rowHeader.appendChild(document.createElement(\"ol\"));\r\n\r\n      let table = tableWrapper.appendChild(document.createElement(\"table\"));\r\n      table.appendChild(document.createElement(\"tbody\"));\r\n\r\n      let toolbar = document.querySelector(\".footer-toolbar\"),\r\n        select = toolbar.querySelector(\"select\");\r\n      select.appendChild(document.createElement(\"option\"));\r\n      let sheetBoormarks = toolbar.querySelector(\".sheet-bookmarks\");\r\n      sheetBoormarks.appendChild(document.createElement(\"div\"));\r\n    }\r\n\r\n    createSheet(columns = this.columns, rows = this.rows, loading = false) {\r\n      let editor = this;\r\n      let toolbar = editor.footerToolbar,\r\n        sheetID = editor.sheetList.length,\r\n        sheetCellsData = {};\r\n\r\n      if (loading) {\r\n        sheetCellsData = editor.loadData() ?\r\n          editor.loadData()[sheetID].cellsList :\r\n          editor.serverData[sheetID].cellsList;\r\n      }\r\n\r\n      let sheet = new Sheet(columns, rows, sheetID, sheetCellsData);\r\n      editor._currentSheet = sheet;\r\n\r\n      let option = toolbar.querySelector(\"select > option:last-child\");\r\n      option.setAttribute(\"value\", sheet.ID);\r\n      option.textContent = sheet.name;\r\n\r\n      let sheetBookmarksList =\r\n        toolbar.querySelectorAll(\".sheet-bookmarks > div\");\r\n      sheetBookmarksList[sheet.ID].id = `${sheet.ID}-sheet-bookmark`;\r\n      sheetBookmarksList[sheet.ID].textContent = option.textContent;\r\n\r\n      editor.sheetList.push(sheet);\r\n      editor.switchSheet(sheet.ID);\r\n\r\n      if (!loading) {\r\n        editor.saveData();\r\n      }\r\n    }\r\n\r\n    saveData() {\r\n      let editor = this;\r\n      let sheetsData = [];\r\n      let objectData;\r\n      editor.sheetList.forEach(ForEachCB, editor);\r\n      objectData = JSON.stringify(sheetsData);\r\n\r\n      localStorage.setItem(this.name, objectData);\r\n      this.postServerData('http://127.0.0.1:3000/save', objectData, function (data) {\r\n        alert(data);\r\n      });\r\n\r\n      function ForEachCB(sheet) {\r\n        let cellsData = {};\r\n\r\n        for (let cell in sheet.cellsList) {\r\n          cellsData[cell] = {\r\n            value: sheet.cellsList[cell].value,\r\n            computedValue: sheet.cellsList[cell].computedValue,\r\n            colIndex: sheet.cellsList[cell].colIndex,\r\n            rowIndex: sheet.cellsList[cell].rowIndex\r\n          };\r\n        }\r\n\r\n        let sheetData = {\r\n          cellsList: cellsData,\r\n          currentRows: sheet._currentRows,\r\n          currentColumns: sheet._currentColumns\r\n        };\r\n\r\n        sheetsData.push(sheetData);\r\n      }\r\n    }\r\n\r\n    getServerData(path, callback) {\r\n      let httpRequest = new XMLHttpRequest();\r\n      httpRequest.open(\"POST\", path);\r\n      httpRequest.send();\r\n\r\n      httpRequest.onreadystatechange = function () {\r\n        if (httpRequest.readyState === 4) {\r\n          if (httpRequest.status === 200) {\r\n            let JSONData = JSON.parse(httpRequest.responseText);\r\n            if (callback) {\r\n              callback(JSONData);\r\n            }\r\n          }\r\n        }\r\n      };\r\n    }\r\n\r\n    postServerData(path, object, callback) {\r\n      let json = object;\r\n      let httpRequest = new XMLHttpRequest();\r\n\r\n      httpRequest.onreadystatechange = function () {\r\n        if (httpRequest.readyState === 4) {\r\n          if (httpRequest.status === 200) {\r\n            let data = httpRequest.responseText;\r\n            if (callback) callback(data);\r\n          }\r\n        }\r\n      };\r\n\r\n      httpRequest.open(\"POST\", path);\r\n      httpRequest.setRequestHeader(\"Content-type\",\r\n        \"text/plain; charset=utf-8\");\r\n      httpRequest.send(json);\r\n    }\r\n\r\n\r\n    addNewSheet(columns, rows) {\r\n      this.initTable();\r\n      this.createSheet(columns, rows);\r\n    }\r\n\r\n    switchSheet(sheetIndex) {\r\n      let sheetBookmarksList =\r\n          this.footerToolbar.querySelectorAll(\".sheet-bookmarks > div\"),\r\n        sheetSelectList =\r\n          this.footerToolbar.querySelectorAll(\"select > option\");\r\n\r\n      for (let i = 0; i < this.sheetList.length; i++) {\r\n        sheetBookmarksList[i].classList.remove(\"bookmark-current-sheet\");\r\n        sheetSelectList[i].removeAttribute(\"selected\");\r\n        this.sheetList[i].sheetContainer.style.display = \"none\";\r\n      }\r\n\r\n      sheetBookmarksList[sheetIndex].classList.add(\"bookmark-current-sheet\");\r\n      sheetSelectList[sheetIndex].setAttribute(\"selected\", \"true\");\r\n\r\n      this._currentSheet = this.sheetList[sheetIndex];\r\n      this._currentSheet.sheetContainer.style.display = \"initial\";\r\n    }\r\n\r\n    deleteSheet(delSheetIndex) {\r\n      let sheetBookmarks =\r\n          this.footerToolbar.querySelector(\".sheet-bookmarks\"),\r\n        sheetBookmarksList =\r\n          this.footerToolbar.querySelectorAll(\".sheet-bookmarks > div\"),\r\n        sheetSelect =\r\n          this.footerToolbar.querySelector(\"select\"),\r\n        sheetSelectList =\r\n          this.footerToolbar.querySelectorAll(\"select > option\"),\r\n        removedSheet = this.sheetList.splice(delSheetIndex)[0];\r\n      this.target.removeChild(removedSheet.sheetContainer);\r\n      sheetBookmarks.removeChild(sheetBookmarksList[delSheetIndex]);\r\n      sheetSelect.removeChild(sheetSelectList[delSheetIndex]);\r\n      this.saveData();\r\n    }\r\n\r\n    initListeners() {\r\n      let select = this.footerToolbar.querySelector(\"select\"),\r\n        newSheetButton =\r\n          this.footerToolbar.querySelector(\".new-sheet-button\"),\r\n        sheetBookmarks =\r\n          this.footerToolbar.querySelector(\".sheet-bookmarks\"),\r\n        saveButton = document.getElementsByClassName(\"menu-button\")[1],\r\n        resetButton = document.getElementsByClassName(\"menu-button\")[2],\r\n        deleteSheetButton = document.getElementsByClassName(\"menu-button\")[3];\r\n\r\n      let switchSheetHdlr = (event) => {\r\n        if (event.target.parentElement.className === \"sheet-bookmarks\" ||\r\n          event.target.tagName === \"SELECT\") {\r\n          let sheetIndex = event.target.value || parseFloat(event.target.id);\r\n          this.switchSheet(sheetIndex);\r\n        }\r\n      };\r\n      let resetDataBasesHdlr = () => {\r\n        localStorage.setItem(this.name, \"\");\r\n      };\r\n      let deleteSheetHndlr = () => {\r\n        let decision = confirm(\r\n          `                       Warning!\r\n\r\nAre you shure you want to delete ${this._currentSheet.name}?\r\n`\r\n        );\r\n        if (!decision) return;\r\n        let delSheetID = this._currentSheet.ID;\r\n        this.switchSheet(this._currentSheet.ID - 1);\r\n        this.deleteSheet(delSheetID);\r\n      };\r\n      newSheetButton.addEventListener(\"click\", () => this.addNewSheet());\r\n      select.addEventListener(\"change\", switchSheetHdlr);\r\n      sheetBookmarks.addEventListener(\"click\", switchSheetHdlr);\r\n      deleteSheetButton.addEventListener(\"click\", deleteSheetHndlr);\r\n      resetButton.addEventListener(\"click\", resetDataBasesHdlr);\r\n      saveButton.addEventListener(\"click\", () => this.saveData());\r\n\r\n\r\n      // window.onunload = () => {\r\n      //     this.saveData();\r\n      // }\r\n    }\r\n  }\r\n\r\n  class Sheet {\r\n\r\n    constructor(columns, rows, sheetID, cellsList) {\r\n      this.name = `Sheet${sheetID + 1}`;\r\n      this.ID = sheetID;\r\n      this._currentRows = 0;\r\n      this._currentColumns = 0;\r\n      this.cellsList = cellsList;\r\n      this.formulaMode = false;\r\n      //this.editor = editor;\r\n\r\n      this.sheetContainer = document.querySelector(\".main>div:last-child\");\r\n      this.sheetContainer.id = `sheet-container-${this.ID}`;\r\n      this.colHeaderList = this.sheetContainer.querySelector(\".col-header ol\");\r\n      this.rowHeaderList = this.sheetContainer.querySelector(\".row-header ol\");\r\n      this.tableWrapper = this.sheetContainer.querySelector(\".table-wrapper\");\r\n      this.tbody = this.tableWrapper.querySelector(\"tbody\");\r\n      this.rowHeader = this.sheetContainer.querySelector(\".row-header\");\r\n      this.colHeader = this.sheetContainer.querySelector(\".col-header\");\r\n      this.corner = this.sheetContainer\r\n        .querySelector(\".col-header-wrapper div:first-child\");\r\n      this.inputConsole = document.querySelector(\".input-console\");\r\n\r\n      this.focusedCell = null;\r\n      this.highlightedHeaders = {\r\n        columns: [],\r\n        rows: []\r\n      };\r\n\r\n      this.addRows(rows);\r\n      this.addColumns(columns);\r\n      this.loadCellsData();\r\n      this.initFocus();\r\n      this.initListeners();\r\n    }\r\n\r\n    insertColHeader() {\r\n      this.colHeaderList.appendChild(document.createElement(\"li\"));\r\n    }\r\n\r\n    insertRowHeader() {\r\n      this.rowHeaderList.appendChild(document.createElement(\"li\"));\r\n    }\r\n\r\n    addRows(rows = 1) {\r\n      for (let i = 0; i < rows; i++) {\r\n        let row = this.tbody.insertRow(-1);\r\n        this.insertRowHeader();\r\n        this._currentRows++;\r\n\r\n        for (let j = 0; j < this._currentColumns; j++) {\r\n          let cell = row.insertCell(-1);\r\n          cell.classList.add(\"data-cell\");\r\n          cell.tabIndex = this._currentRows + \"\";\r\n        }\r\n      }\r\n    }\r\n\r\n    addColumns(columns = 1) {\r\n      let rowList = this.tbody.querySelectorAll(\"tr\");\r\n      this._currentColumns += columns;\r\n\r\n      for (let i = 0; i < this._currentRows; i++) {\r\n        for (let j = 0; j < columns; j++) {\r\n          if (i === 0) {\r\n            this.insertColHeader();\r\n          }\r\n\r\n          let cell = rowList[i].insertCell(-1);\r\n          cell.classList.add(\"data-cell\");\r\n          cell.tabIndex = i + 1 + \"\";\r\n        }\r\n      }\r\n    }\r\n\r\n    loadCellsData() {\r\n      let sheet = this;\r\n      for (let cell in sheet.cellsList) {\r\n        let currentCell = sheet.cellsList[cell];\r\n        a(currentCell.rowIndex);\r\n        a(currentCell.value);\r\n        sheet.cellsList[cell] = new Cell(\r\n          currentCell.rowIndex,\r\n          currentCell.colIndex,\r\n          sheet.tbody,\r\n          currentCell.value,\r\n          currentCell.computedValue\r\n        );\r\n        currentCell = sheet.cellsList[cell];\r\n        let targetRow = sheet.tbody.children[currentCell.rowIndex];\r\n        let targetCell = targetRow.children[currentCell.colIndex];\r\n        targetCell.innerHTML = currentCell._computedValue;\r\n      }\r\n    }\r\n\r\n    initFocus() {\r\n      let cell = Utils.findCellOnSheet(0, 0, this.tbody);\r\n      this.focusedCell = cell;\r\n      cell.classList.add(\"focused-cell\");\r\n      this.highlightedHeaders.rows.push(this.rowHeaderList.children[0]);\r\n      this.highlightedHeaders.columns.push(this.colHeaderList.children[0]);\r\n      this.rowHeaderList.children[0].classList.add(\"cell-header-highlight\");\r\n      this.colHeaderList.children[0].classList.add(\"cell-header-highlight\");\r\n    }\r\n\r\n    listenersControl(active = true) {\r\n      let cornerHeight = parseFloat(\r\n        window.getComputedStyle(this.corner).height\r\n        ),\r\n        cornerWidth = parseFloat(\r\n          window.getComputedStyle(this.corner).width\r\n        );\r\n\r\n      this.cellInput = document.createElement(\"input\");\r\n      let input = this.cellInput;\r\n\r\n      let removeLastFocus = () => {\r\n        this.focusedCell\r\n          .classList\r\n          .remove(\"focused-cell\", \"focused-input-cell\");\r\n      };\r\n      let inputDone = () => {\r\n        if (this.formulaMode === true) return;\r\n\r\n        let {rowIndex, colIndex, cellName} = Utils\r\n          .getCellCoordinates(input.parentNode);\r\n\r\n        if (input.value === \"\") {\r\n          input.parentNode.innerHTML = \"\";\r\n          delete this.cellsList[cellName];\r\n          return;\r\n        }\r\n        if (!this.cellsList[cellName] && input.value !== \"\") {\r\n          this.cellsList[cellName] =\r\n            new Cell(rowIndex, colIndex, this.tbody);\r\n        }\r\n        this.cellsList[cellName].value = input.value;\r\n\r\n        input.parentElement.innerHTML = input.value;\r\n        synchronize();\r\n\r\n        input.value = \"\";\r\n        this.inputConsole.value = input.value;\r\n      };\r\n      let translateToConsole = (event) => {\r\n        if (!this.formulaMode && event.target.tagName === \"TD\") {\r\n          let {cellName} = Utils.getCellCoordinates(event);\r\n\r\n          if (this.cellsList[cellName] instanceof Cell) {\r\n            this.inputConsole.value = this.cellsList[cellName].value;\r\n          } else {\r\n            this.inputConsole.value = event.target.innerHTML;\r\n          }\r\n        }\r\n      };\r\n      let formulaModeToggle = (inputDone = false) => {\r\n        if (inputDone) {\r\n          this.formulaMode = false;\r\n        } else {\r\n          this.formulaMode = (input.value[0] === \"=\");\r\n        }\r\n\r\n        if (this.formulaMode) {\r\n          input.addEventListener(\"blur\", forcedFormulaModeFocusHdlr);\r\n          this.inputConsole.addEventListener(\"blur\", forcedFormulaModeFocusHdlr);\r\n          this.tableWrapper\r\n            .addEventListener(\"click\", formulaPickCellHdlr);\r\n        } else {\r\n          input.removeEventListener(\"blur\", forcedFormulaModeFocusHdlr);\r\n          this.inputConsole.removeEventListener(\"blur\", forcedFormulaModeFocusHdlr);\r\n          this.tableWrapper\r\n            .removeEventListener(\"click\", formulaPickCellHdlr);\r\n\r\n          let pickedCellsNodes = this\r\n            .tableWrapper\r\n            .querySelectorAll(\".formula-mode-picked-cell\");\r\n\r\n          for (let i = 0; i < pickedCellsNodes.length; i++) {\r\n            pickedCellsNodes[i].classList.remove(\"formula-mode-picked-cell\");\r\n          }\r\n        }\r\n      };\r\n      let synchronize = () => {\r\n        for (let cell in this.cellsList) {\r\n          let cellOnSheet = this.cellsList[cell].cellNode;\r\n          cellOnSheet.innerHTML = this.cellsList[cell].computedValue;\r\n        }\r\n      };\r\n\r\n      let pullHeadersHdlr = (event) => {\r\n        let rowHeader = this.rowHeader,\r\n          colHeader = this.colHeader;\r\n        rowHeader.style.top =\r\n          cornerHeight - this.tableWrapper.scrollTop + \"px\";\r\n        colHeader.style.left =\r\n          cornerWidth - this.tableWrapper.scrollLeft + \"px\";\r\n      };\r\n      let dynamicAddCellsHdlr = (event) => {\r\n        let sheet = event.currentTarget,\r\n          toEdgeOfSheetCols =\r\n            sheet.scrollWidth - (sheet.clientWidth + sheet.scrollLeft),\r\n          toEdgeOfSheetRows =\r\n            sheet.scrollHeight - (sheet.clientHeight + sheet.scrollTop);\r\n\r\n        if (toEdgeOfSheetCols < 200) {\r\n          this.addColumns(10);\r\n        }\r\n\r\n        if (toEdgeOfSheetRows < 120) {\r\n          this.addRows(10);\r\n        }\r\n      };\r\n      let focusinCellHdlr = (event) => {\r\n        if (event.target === input) {\r\n          removeLastFocus();\r\n          this.focusedCell = input.parentElement;\r\n          this.focusedCell.classList.add(\"focused-input-cell\");\r\n        }\r\n\r\n        if (this.formulaMode === true) return;\r\n\r\n        if (event.target.tagName === \"TD\") {\r\n          if (this.focusedCell.firstChild === input) {\r\n            inputDone();\r\n          }\r\n          removeLastFocus();\r\n          this.focusedCell = event.target;\r\n          event.target.classList.add(\"focused-cell\");\r\n          translateToConsole(event);\r\n        }\r\n      };\r\n      let headersHighlightHdlr = (event) => {\r\n        if (this.formulaMode === true) return;\r\n\r\n        let removeHiglighted = () => {\r\n          for (let item of this.highlightedHeaders.columns) {\r\n            item.classList.remove(\"cell-header-highlight\")\r\n          }\r\n          this.highlightedHeaders.columns.length = 0;\r\n\r\n          for (let item of this.highlightedHeaders.rows) {\r\n            item.classList.remove(\"cell-header-highlight\")\r\n          }\r\n          this.highlightedHeaders.rows.length = 0;\r\n        };\r\n\r\n        if (event.target.tagName === \"TD\") {\r\n          removeHiglighted();\r\n\r\n          let rowIndex = event.target.parentElement.rowIndex;\r\n          let colIndex = event.target.cellIndex;\r\n          this.rowHeaderList.children[rowIndex]\r\n            .classList.add(\"cell-header-highlight\");\r\n          this.colHeaderList.children[colIndex]\r\n            .classList.add(\"cell-header-highlight\");\r\n          this.highlightedHeaders\r\n            .rows.push(this.rowHeaderList.children[rowIndex]);\r\n          this.highlightedHeaders\r\n            .columns.push(this.colHeaderList.children[colIndex]);\r\n        }\r\n      };\r\n      let invokeInputHdlr = (event) => {\r\n        if (this.formulaMode === true ||\r\n          event.target === input ||\r\n          event.keyCode === Utils.keyCode.backspace ||\r\n          event.keyCode === Utils.keyCode.del) {\r\n          return;\r\n        }\r\n\r\n        a(this);\r\n        let {cellName} = Utils.getCellCoordinates(this.focusedCell);\r\n\r\n        if (event.keyCode &&\r\n          event.keyCode !== Utils.keyCode.enter) {\r\n          input.value = \"\";\r\n        } else if (this.cellsList[cellName]) {\r\n          input.value = this.cellsList[cellName].value;\r\n        }\r\n        else {\r\n          input.value = \"\";\r\n        }\r\n        this.focusedCell.innerHTML = \"\";\r\n        this.focusedCell.appendChild(input);\r\n        a(`input invoked: ${this.name}`);\r\n\r\n        if (event.target.tagName === \"TD\") {\r\n          input.focus();\r\n        }\r\n      };\r\n      let consoleFocusHdlr = (event) => {\r\n        a(`Console focused: ${this.name}`);\r\n        if (event.relatedTarget === input) return;\r\n        invokeInputHdlr(event);\r\n        removeLastFocus();\r\n        this.focusedCell = input.parentElement;\r\n        this.focusedCell.classList.add(\"focused-input-cell\");\r\n      };\r\n      let consoleInputChangeHdlr = () => {\r\n        a(`Console input changed: ${this.name}`);\r\n        input.value = this.inputConsole.value;\r\n        formulaModeToggle();\r\n      };\r\n      let inputKeyDoneHdlr = (event) => {\r\n        if (event.keyCode === Utils.keyCode.enter) {\r\n          let {rowIndex, colIndex} =\r\n            Utils.getCellCoordinates(input.parentElement);\r\n\r\n          formulaModeToggle(true);\r\n          let nextFocusCell =\r\n            Utils.findCellOnSheet(rowIndex + 1, colIndex, this.tbody);\r\n          setTimeout(function () {\r\n            nextFocusCell.focus();\r\n          }, 0);\r\n        }\r\n      };\r\n      let formulaPickCellHdlr = (event) => {\r\n        if (event.target === input) {\r\n          return\r\n        }\r\n\r\n        if (input.value.search(Utils.regExp.pickingInputEnding) >= 0) {\r\n          let linkEndingPos = input\r\n            .value\r\n            .search(Utils.regExp.cellLinkEnding);\r\n          let {cellName} = Utils.getCellCoordinates(event);\r\n          if (linkEndingPos >= 0) {\r\n            let lastPickName = input.value.slice(linkEndingPos);\r\n            let {rowIndex, colIndex} = Utils\r\n              .getCellCoordinates(lastPickName);\r\n            let lastCellNode = Utils\r\n              .findCellOnSheet(rowIndex, colIndex, this.tbody);\r\n\r\n            lastCellNode.classList.remove(\"formula-mode-picked-cell\");\r\n            input.value = input.value.slice(0, linkEndingPos);\r\n          }\r\n          event.target.classList.add(\"formula-mode-picked-cell\");\r\n          input.value += cellName;\r\n          this.inputConsole.value = input.value;\r\n        }\r\n      };\r\n      let forcedFormulaModeFocusHdlr = (event) => {\r\n        if (event.relatedTarget === input ||\r\n          event.relatedTarget === this.inputConsole) return;\r\n\r\n        input.parentElement.focus();\r\n        event.target.focus();\r\n      };\r\n      let inputValueChangeHdlr = () => {\r\n        formulaModeToggle();\r\n        this.inputConsole.value = input.value;\r\n      };\r\n      let clearCellDataHdlr = (event) => {\r\n        if (event.target.tagName !== \"TD\") {\r\n          return;\r\n        }\r\n        if (event.keyCode === Utils.keyCode.alt ||\r\n          event.keyCode === Utils.keyCode.backspace) {\r\n          event.preventDefault();\r\n        }\r\n        if (event.target.innerHTML === \"\") return;\r\n        if (event.keyCode === Utils.keyCode.backspace ||\r\n          event.keyCode === Utils.keyCode.del) {\r\n          let {cellName} = Utils.getCellCoordinates(event);\r\n          delete this.cellsList[cellName];\r\n          event.target.innerHTML = \"\";\r\n          synchronize();\r\n        }\r\n      };\r\n      let changeFocusHdlr = (event) => {\r\n        if (event.target === input &&\r\n          Utils.keyCode.arrows.includes(event.keyCode)) {\r\n          return;\r\n        }\r\n        if (Utils.keyCode.arrows.includes(event.keyCode)) {\r\n          let {rowIndex, colIndex} = Utils.getCellCoordinates(event);\r\n          event.preventDefault();\r\n\r\n          switch (event.keyCode) {\r\n            case Utils.keyCode.arrowLeft:\r\n              colIndex = colIndex || 1;\r\n              Utils.findCellOnSheet(rowIndex, colIndex - 1, this.tbody)\r\n                .focus();\r\n              break;\r\n            case Utils.keyCode.arroRight:\r\n              Utils.findCellOnSheet(rowIndex, colIndex + 1, this.tbody)\r\n                .focus();\r\n              break;\r\n            case Utils.keyCode.arrowDown:\r\n              Utils.findCellOnSheet(rowIndex + 1, colIndex, this.tbody)\r\n                .focus();\r\n              break;\r\n            case Utils.keyCode.arrowUp:\r\n              rowIndex = rowIndex || 1;\r\n              Utils.findCellOnSheet(rowIndex - 1, colIndex, this.tbody)\r\n                .focus();\r\n              break;\r\n          }\r\n        }\r\n      };\r\n\r\n      if (typeof active === \"boolean\" && active) {\r\n        this.tableWrapper.addEventListener(\"scroll\", pullHeadersHdlr);\r\n        this.tableWrapper.addEventListener(\"scroll\", dynamicAddCellsHdlr);\r\n        this.tableWrapper.addEventListener(\"focusin\", focusinCellHdlr);\r\n        this.tableWrapper.addEventListener(\"focusin\", headersHighlightHdlr);\r\n        this.tableWrapper.addEventListener(\"dblclick\", invokeInputHdlr);\r\n        this.tableWrapper.addEventListener(\"keypress\", invokeInputHdlr);\r\n        this.tableWrapper.addEventListener(\"keydown\", clearCellDataHdlr);\r\n        this.tableWrapper.addEventListener(\"keydown\", changeFocusHdlr);\r\n\r\n        this.inputConsole.addEventListener(\"focus\", consoleFocusHdlr);\r\n        this.inputConsole.addEventListener(\"input\", consoleInputChangeHdlr);\r\n        this.inputConsole.addEventListener(\"keydown\", inputKeyDoneHdlr);\r\n\r\n        input.addEventListener(\"keydown\", inputKeyDoneHdlr);\r\n        input.addEventListener(\"input\", inputValueChangeHdlr);\r\n        a(`Listeners run: ${this.name}`)\r\n      }\r\n\r\n      if (typeof active === \"boolean\" && !active) {\r\n        this.tableWrapper.removeEventListener(\"scroll\", pullHeadersHdlr);\r\n        this.tableWrapper.removeEventListener(\"scroll\", dynamicAddCellsHdlr);\r\n        this.tableWrapper.removeEventListener(\"focusin\", focusinCellHdlr);\r\n        this.tableWrapper.removeEventListener(\"focusin\", headersHighlightHdlr);\r\n        this.tableWrapper.removeEventListener(\"dblclick\", invokeInputHdlr);\r\n        this.tableWrapper.removeEventListener(\"keypress\", invokeInputHdlr);\r\n        this.inputConsole.removeEventListener(\"focus\", consoleFocusHdlr);\r\n        this.inputConsole.removeEventListener(\"input\", consoleInputChangeHdlr);\r\n        input.removeEventListener(\"keydown\", inputKeyDoneHdlr);\r\n        this.inputConsole.removeEventListener(\"keydown\", inputKeyDoneHdlr);\r\n        input.removeEventListener(\"input\", inputValueChangeHdlr);\r\n        this.tableWrapper.removeEventListener(\"keydown\", clearCellDataHdlr);\r\n        this.tableWrapper.removeEventListener(\"keydown\", changeFocusHdlr);\r\n        a(`Listeners stopped: ${this.name}`);\r\n      }\r\n    }\r\n\r\n    initListeners() {\r\n      this.listenersControl(true);\r\n    }\r\n\r\n    stopListeners() {\r\n      this.listenersControl(false);\r\n    }\r\n  }\r\n\r\n  class Cell {\r\n\r\n    constructor(rowIndex, colIndex, tbody, value, computedValue) {\r\n      this.colIndex = colIndex;\r\n      this.rowIndex = rowIndex;\r\n      this.value = value;\r\n      this.tbody = tbody;\r\n      this.computedValue = computedValue;\r\n    }\r\n\r\n    get cellNode() {\r\n      return Utils.findCellOnSheet(this.rowIndex, this.colIndex, this.tbody)\r\n    }\r\n\r\n    get name() {\r\n      return `${Utils.getCellName}`;\r\n    }\r\n\r\n    get value() {\r\n      return this._value;\r\n    }\r\n\r\n    set value(value) {\r\n      this._value = value;\r\n    }\r\n\r\n    set computedValue(value) {\r\n      this._computedValue = value;\r\n    }\r\n\r\n    get computedValue() {\r\n      let newValue = this.value;\r\n      if (newValue.startsWith(\"=\")) {\r\n        newValue = Utils.computeValue(newValue.slice(1), this.tbody);\r\n      }\r\n      this._computedValue = newValue;\r\n      return this._computedValue;\r\n    }\r\n  }\r\n  new SheetEditor();\r\n})();"]}